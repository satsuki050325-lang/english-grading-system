# English Grading System
**大学受験英語 AI補助採点システム**

予備校でのアルバイト業務（英語答案の採点・添削）を効率化するために開発した、マルチモーダルAIを活用した補助採点システムです。AIが採点の下処理を担い、最終確認・手直しは必ず講師が行うHuman-in-the-Loopの設計を採用しています。

---

## デモ動画

[![デモ動画](https://img.youtube.com/vi/Xjwae0sJoVo/0.jpg)](https://youtu.be/Xjwae0sJoVo)

---

## 開発背景

予備校の添削アルバイトでは、答案1枚あたりの単価が70〜300円と低く、慣れない時期は時給換算で最低賃金を大きく下回る状況でした。作業の中に繰り返し性の高い工程（採点記号の記入・似たような指摘コメントの作成・名前や点数の転記）が多く含まれており、これを自動化したいと考えたのが開発のきっかけです。

当初はAIに直接採点させる方法を試みましたが、以下の問題が発生しました。

- ハルシネーション（事実でない内容の生成）
- 採点基準の無視・解説資料の読み飛ばし
- 指摘事項が増えるにつれ過去の注意を忘れる

これらの問題を解決するため、「AIが下処理、人間が最終確認」というアーキテクチャを採用し、システムとして再設計しました。

ちょうどPythonの学習を一通り終えたタイミングで、「PDFから情報を取り出しExcelに自動記入するシステム」を自力で作った経験があり、その延長として本格的なシステム開発に挑戦しました。

---

## システム概要

```
答案PDF（手書き） → テキスト抽出（Gemini） → 講師による確認・修正 → 採点（Claude） → 採点済みPDF出力
```

### 主な機能

- 手書き答案PDFからのテキスト抽出（記述式・マークシート両対応）
- 採点基準JSONに基づいたAI自動採点・添削コメント生成
- 採点結果の答案PDF直接印字
- テキスト確認・修正のためのデスクトップGUI
- 答案用紙レイアウトに合わせた座標取得ツール

---

## 技術スタック

| カテゴリ | 技術 |
|---|---|
| フロントエンド | React / TypeScript / Vite / Tailwind CSS |
| バックエンド | Python 3.13 / pywebview |
| AI（テキスト抽出） | Google Gemini 2.5 Flash（マルチモーダル） |
| AI（採点） | Anthropic Claude Sonnet（プロンプトキャッシュ活用） |
| PDF操作 | PyMuPDF（fitz） |
| 画像処理 | Pillow |
| GUI（座標取得ツール） | Tkinter |

---

## 設計上の判断・工夫点

### GeminiからClaudeへの役割分担
テキスト抽出にはGemini、採点にはClaudeと役割を分けています。当初は採点もGeminiで行っていましたが、採点基準の複雑な条件分岐への対応や日本語添削コメントの品質に問題がありました。実際に両者を比較検証した上でClaudeへの切り替えを判断しています。

### AIが苦手な部分をコードで補う設計
マークシートの読み取りは、画像全体をAIに渡すと精度が低下する問題がありました。そこでAIにマークシート欄の座標を検出させ、その部分だけを切り抜いてから再度AIに渡す2段階処理を実装しています。また答案画像のコントラストを自動調整するロジックも追加し、薄い鉛筆書きへの対応も行っています。

### Human-in-the-Loopの採用
AIの誤読・誤採点はゼロにできないという前提に立ち、講師が採点前にテキストを確認・修正できるステップを設けています。AIが生成する添削コメントはあくまで補助であり、最終的な手直しは必ず講師が行う運用を想定しています。

### 座標取得ツールの自作
採点結果をPDFの正確な位置に印字するには、答案用紙レイアウトごとの座標情報が必要です。この座標をコードを触らずに取得できるよう、PDFを表示しながらドラッグで座標を記録するGUIツールを自作しました。新しい答案用紙への対応をノンエンジニアでも行えることを意識しています。

### プロンプトキャッシュの活用
採点基準JSONと解説テキストは答案ごとに変わらないため、Anthropicのプロンプトキャッシュ機能を活用しています。複数答案を処理する際のAPIコストを削減しています。

### UIデザインの方針（業務ツールとしてのUX設計）
添削業務は長時間・細かい作業が続くため、精神的な落ち着きを意識したデザインを採用しました。ダークトーンの落ち着いた色合い、角を削った角丸・影付きのカード型レイアウトにより、視覚的なストレスを軽減しています。

パネルの配置はPDF→テキスト→Functionパネルの左から右への流れを意図しています。右利きの操作動線（PDFを確認→テキストを修正→ボタンを押す）に合わせることで、疲れにくい作業環境を実現しています。

誤操作防止として、Step2/3の完了前は「PDF XChange Editorで開く」ボタンと「最初に戻る」ボタンをロック・グレーアウトしています。処理の完了状態に応じてUIが変化することで、次に何をすべきかを直感的に伝える設計にしています。

---

## 工数削減効果

8枚処理時の実測値（実験データより）

| | 従来（手作業） | 本システム |
|---|---|---|
| 処理時間 | 約210分 | 約53分 |
| 削減率 | — | **約75%削減** |

※本システムの内訳：AI処理約13分 + テキスト確認約20分 + 最終確認約20分  
※閑散期のため実運用は1回。過去答案20枚を用いた実験を複数回実施し改善を重ねています。

---

## セットアップ手順

### 必要環境

- Python 3.13以上
- Node.js 18以上
- Google AI Studio APIキー（Gemini用）
- Anthropic APIキー（Claude用）

### インストール

```bash
# リポジトリのクローン
git clone https://github.com/Satsuki050325-lang/english-grading-system.git
cd english-grading-system

# Pythonパッケージのインストール
pip install google-genai anthropic PyMuPDF pillow python-dotenv pywebview

# フロントエンドのインストール
npm install
```

### 環境変数の設定

`.env`ファイルをルートに作成し、以下を記述してください。

```
GOOGLE_API_KEY=your_google_api_key
ANTHROPIC_API_KEY=your_anthropic_api_key
```

### 設定ファイルの作成

```bash
cp config.example.json config.json
```

`config.json`を開き、`grader_name`に採点者名を入力してください。

---

## 使い方

### アプリの起動

ターミナルを2つ開き、それぞれ以下を実行してください。

```bash
# ターミナル1：フロントエンド起動
npm run dev

# ターミナル2：バックエンド起動
python backend.py
```

### 採点の流れ

1. **答案PDFの取り込み**：ZIPまたはPDFを選択してアプリに取り込む
2. **テキスト抽出**（Step1）：GeminiがPDFを読み取りテキストに変換
3. **確認・修正**：抽出されたテキストを画面上で確認・修正
4. **採点・印字**（Step2/3）：Claudeが採点し、結果をPDFに印字
5. **出力確認**：`step3_final/`フォルダに採点済みPDFが生成される

### 新しい答案用紙への対応（座標取得ツール）

```bash
python coordinate_picker.py
```

GUIが起動するので、採点結果を印字したい位置をドラッグして座標を登録してください。

---

## ディレクトリ構成

```
english-grading-system/
├── src/                       # Reactフロントエンド
├── coord_db/                  # 答案用紙ごとの座標データ
├── masters/                   # 採点基準JSON
├── rubric_txts/               # 解説・模範解答テキスト
├── inputs/                    # 取り込み答案PDF（.gitignore対象）
├── step1_texts/               # 抽出テキスト（.gitignore対象）
├── step3_final/               # 採点済みPDF（.gitignore対象）
├── backend.py                 # pywebviewバックエンド
├── step1_mark_and_text_v2.py  # テキスト抽出スクリプト
├── step2_and3_combined.py     # 採点・PDF印字スクリプト
├── coordinate_picker.py       # 座標取得GUIツール
└── config.example.json        # 設定ファイルテンプレート
```

---

## 開発期間

2026年2月〜（約3週間）  
Python学習開始：2024年12月

---

## 今後の開発予定

- 解説テキスト自動生成機能
- 点数データのCSV出力・管理機能
- 他講師への展開・製品化の検討

